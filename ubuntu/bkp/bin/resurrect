#!/usr/bin/env bash

function resurrect () {
    resurrect_dir="$HOME/.tmux/resurrect"
    trg="$resurrect_dir/last"
    Q="${1:-*}"
    GREP_CMD='grep -lri'
    src=$(\
        FZF_DEFAULT_COMMAND="$GREP_CMD $(printf %q $Q) $resurrect_dir | sort -r" \
        fzf --disabled \
            --query=$1 \
            --preview 'bat --color=always {1}' \
            --bind "change:reload:sleep 0.1; $GREP_CMD {q} $resurrect_dir | sort -r  || true" \
            --height 40% \
            --preview-window=right:70% \
            --keep-right \
            --reverse \
            --prompt 'resurrect -> ' \
            --header-first \
    )

    [ -n "$src" ] && echo "ln -sf $src $trg" && ln -sf $src $trg && echo resurrect: $src
}

# echo resurrect \"${@}\"
resurrect ${@}
