#!/usr/bin/env bash
# taken from https://github.com/ThePrimeagen/.dotfiles/blob/master/bin/.local/bin/tmux-sessionizer

directory=$1
session_name=$2

if [ -z "$directory" ]; then
    directory=`listProjects | fzf --header=Projects --reverse --ansi --query "$1" --height 10% -m --header="Create a new tmux session"`
fi

if [[ -z $directory ]]; then
    exit 0
fi

if [[ -z $session_name ]]; then
    session_name=$(basename "$directory" | tr . _)
fi

tmux_running=$(pgrep tmux)
if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
    tmux new-session -s $session_name -c $directory
    exit 0
fi

if ! tmux has-session -t $session_name 2> /dev/null; then
    tmux new-session -ds $session_name -c $directory
fi

if [[ -z $TMUX ]]; then
    tmux attach-session -t $session_name
else
    tmux switch-client -t $session_name
fi

